graph TD
    subgraph "Build Phase (with Caching)"
        A[Code Push/PR] --> B[Checkout Code]
        B --> C[Setup Docker Buildx]
        C --> D[Login to Registry]
        D --> E[Build & Push Backend]
        D --> F[Build & Push Frontend]
        D --> G[Build & Push Test Runner]

        E --> H[Cache Layers]
        F --> H
        G --> H
    end

    subgraph "Test Phase (Pull & Run)"
        H --> I[Pull Images from Registry]
        I --> J[Tag for Local Use]
        J --> K[Run Core Tests]
        J --> L[Run Analysis Tests]
        J --> M[Run Debug Tests]
        J --> N[Run Comprehensive Tests]
        J --> O[Run Mobile Core Tests]
        J --> P[Run Mobile Analysis Tests]
        J --> Q[Run Mobile Comprehensive Tests]

        K --> R[Upload Test Results]
        L --> R
        M --> R
        N --> R
        O --> R
        P --> R
        Q --> R
    end

    R --> S[Deploy/Notify]

    style A fill:#e1f5fe
    style H fill:#f3e5f5
    style R fill:#e8f5e8
    style S fill:#fff3e0
